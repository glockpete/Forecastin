[
  {
    "id": "qw-001",
    "title": "Add zod validation to WebSocket message handler",
    "description": "Wrap parseRealtimeMessage() around all incoming WebSocket data to catch malformed messages before they corrupt state",
    "files": [
      "frontend/src/handlers/realtimeHandlers.ts",
      "frontend/src/hooks/useWebSocket.ts"
    ],
    "eta_hours": 2,
    "impact": "high",
    "confidence": 0.95,
    "rationale": "Prevents crashes from malformed messages. Single function call addition. Already have zod schemas ready.",
    "dependencies": [],
    "testing": "Unit test with invalid mock, verify error logged and state unchanged"
  },
  {
    "id": "qw-002",
    "title": "Integrate MessageDeduplicator into RealtimeMessageProcessor",
    "description": "Add deduplicator.isNew() check before processing messages to prevent duplicate renders",
    "files": [
      "frontend/src/handlers/realtimeHandlers.ts"
    ],
    "eta_hours": 1,
    "impact": "medium",
    "confidence": 0.9,
    "rationale": "Reduces redundant cache updates and renders during network retries. Class already implemented, just needs integration.",
    "dependencies": [],
    "testing": "Send duplicate message, verify only processed once"
  },
  {
    "id": "qw-003",
    "title": "Add periodic cleanup timer to MessageDeduplicator",
    "description": "setInterval cleanup every windowMs to prevent memory leak during idle periods",
    "files": [
      "frontend/src/types/ws_messages.ts"
    ],
    "eta_hours": 0.5,
    "impact": "medium",
    "confidence": 0.95,
    "rationale": "Fixes memory leak with 3-line change. Critical for long-running sessions.",
    "dependencies": [],
    "testing": "Unit test: wait beyond window, verify map cleared"
  },
  {
    "id": "qw-004",
    "title": "Batch cache updates in processBulkUpdate",
    "description": "Suspend queries during batch, update all items, then single invalidation",
    "files": [
      "frontend/src/handlers/realtimeHandlers.ts"
    ],
    "eta_hours": 3,
    "impact": "high",
    "confidence": 0.85,
    "rationale": "Eliminates N+1 query problem. Reduces 100-item batch from ~3s to <100ms. Major UX improvement.",
    "dependencies": [],
    "testing": "Benchmark: 100-item batch should complete in <100ms"
  },
  {
    "id": "qw-005",
    "title": "Separate EntityDataPoint into geometry-specific types",
    "description": "Create discriminated union with PointEntity | PolygonEntity | LinestringEntity",
    "files": [
      "frontend/src/layers/types/layer-types.ts",
      "frontend/src/types/contracts.generated.ts"
    ],
    "eta_hours": 4,
    "impact": "high",
    "confidence": 0.8,
    "rationale": "Enables zod .strict() validation. Catches excess properties at compile time. Improves type safety across codebase.",
    "dependencies": [],
    "testing": "TypeScript compilation with strict mode, no errors"
  },
  {
    "id": "qw-006",
    "title": "Add error boundary to WebSocket message processing",
    "description": "Wrap message handler in try/catch with structured error logging",
    "files": [
      "frontend/src/hooks/useWebSocket.ts"
    ],
    "eta_hours": 1.5,
    "impact": "high",
    "confidence": 0.9,
    "rationale": "Prevents single bad message from breaking entire pipeline. Essential resilience pattern.",
    "dependencies": [],
    "testing": "Send malformed message, verify handler continues processing subsequent messages"
  },
  {
    "id": "qw-007",
    "title": "Make WebSocket port configurable via env var",
    "description": "Read REACT_APP_WS_PORT and fallback to 9000",
    "files": [
      "frontend/src/config/env.ts"
    ],
    "eta_hours": 0.25,
    "impact": "low",
    "confidence": 1.0,
    "rationale": "One-line change. Improves deployment flexibility. No downside.",
    "dependencies": [],
    "testing": "Set env var, verify connection uses correct port"
  },
  {
    "id": "qw-008",
    "title": "Add CI job for contract drift verification",
    "description": "Run npm run contracts:check in CI, fail build if any mock invalid",
    "files": [
      ".github/workflows/ci.yml"
    ],
    "eta_hours": 0.5,
    "impact": "medium",
    "confidence": 0.95,
    "rationale": "Prevents invalid mocks from reaching main. Low effort, high value.",
    "dependencies": ["qw-001"],
    "testing": "Commit invalid mock, verify CI fails"
  },
  {
    "id": "qw-009",
    "title": "Add production mode skip for zod validation",
    "description": "Check NODE_ENV and skip validation in production for performance",
    "files": [
      "frontend/src/types/ws_messages.ts"
    ],
    "eta_hours": 0.5,
    "impact": "low",
    "confidence": 0.85,
    "rationale": "Eliminates 0.5-2ms overhead per message in production. Safety in dev, speed in prod.",
    "dependencies": ["qw-001"],
    "testing": "Benchmark: 200 msgs/sec, verify latency <50ms"
  },
  {
    "id": "qw-010",
    "title": "Add feature flag smoke test to CI",
    "description": "Run smoke_geo.ts in CI to verify ff dependency chain",
    "files": [
      ".github/workflows/ci.yml",
      "scripts/feature_flags/smoke_geo.ts"
    ],
    "eta_hours": 1,
    "impact": "medium",
    "confidence": 0.9,
    "rationale": "Catches misconfigurations before deployment. Prevents broken feature rollouts.",
    "dependencies": [],
    "testing": "Misconfigure ff, verify CI fails with clear error"
  },
  {
    "id": "qw-011",
    "title": "Add tests for verify_contract_drift.ts script",
    "description": "Unit tests covering validation logic for both valid and invalid mocks",
    "files": [
      "scripts/__tests__/verify_contract_drift.test.ts"
    ],
    "eta_hours": 2,
    "impact": "low",
    "confidence": 0.9,
    "rationale": "Ensures script itself is tested. Meta-testing prevents false positives/negatives.",
    "dependencies": [],
    "testing": "Test script against known-good and known-bad mocks"
  },
  {
    "id": "qw-012",
    "title": "Add performance benchmarks to CI",
    "description": "Vitest benchmark suite measuring message processing latency",
    "files": [
      "frontend/tests/performance.bench.ts"
    ],
    "eta_hours": 3,
    "impact": "medium",
    "confidence": 0.8,
    "rationale": "Tracks performance regressions. Validates <10ms render, <50ms latency SLOs.",
    "dependencies": ["qw-004"],
    "testing": "Run benchmark, verify all SLOs met"
  }
]
